<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>findwaldo/</title>
	<link rel="stylesheet" href="globals.css" />
</head>
<body>
	<nav>
		<div>
			<h2>findwaldo/</h2>
		</div>
		<div>

		</div>
	</nav>
	<header class="">
		<h1 class="container flex">findwaldo/</h1>
		<div>
			<div>
				<form method="post" action="" autocomplete="off">
					<input type="text" id="tld" name="tld" placeholder="Top-Level-Domain" />
					<input type="text" id="chatname" name="chatname" placeholder="hnschat.name" />
					<button type="submit" id="add-tld-watcher">
						MARCO
					</button>
					
				</form>
			</div>
		</div>
		<div></div>
	</header>
	<main>
		<div>
			<div id="legenda" class="container flex wrap">
				<div class="ranking">
					<h6 class="--orange">BeezKneez</h6>
					<span>üî•</span>
				</div>
				<div class="ranking">
					<h6 class="--deeppink">KindaHot</h6>
					<span>üòç</span>
				</div>
				<div class="ranking">
					<h6 class="--blue">HollaAtYa</h6>
					<span>ü§ù</span>
				</div>
			</div>
			<div class="container flex">
				<input type="text" placeholder="under construction">
				<input type="button" value="search">
			</div>
		</div>
		<div class="container flex wrap" id="slds" data-stdout="tlds">
			
			
		</div>
	</main>
	<aside></aside>
	<footer></footer>
	<script>
		(async () =>{
			const data = fetch("https://donna.hsd.services/findwaldo/v1/list?x-api-key=Sxh90-8s00Y-D98dy-9jdpd")
			.then(res=>res.json())
			.then(data=>{
				const tlds = data.documents;
				tlds.forEach((doc,index)=>{
					const tld = doc.tld;
					const watchers = doc.watchers;
					document.querySelector(`[data-stdout="tlds"]`).innerHTML += `
						<div key="${index}" id="wrapper-${index}" class="container flex wrapper">
							<div id="card-${index}" class="container card">
								<h4 id="title-${index}" class="container flex title">
									.${tld}/
								</h4>
								<p class="subtext">
									Watching: ${typeof watchers === 'string' ? 1 : watchers.length}
								</p>
								<div id="tag-${index}" class="container flex anchor ranked tag">
									<span>
										
									</span>
								</div>
							</div>
						</div>
					`;
				})
			})
			.catch(err=>{
				console.log(err);
			})
			function submitHandler(e) {
				e.preventDefault();
				const tld = document.querySelector(`#tld`).value;
				const name = document.querySelector(`#chatname`).value;
				if(!!tld && tld!=='' && !!name && name!=='') {
					const domain = tld.replace(".","").replace("/","");
					const hnsname = name.replace(".","").replace("/","");
					fetch(`https://donna.hsd.services/findwaldo/v1/add/	${domain}/${hnsname}?x-api-key=Sxh90-8s00Y-D98dy-9jdpd`)
					.then(res=>res.json())
					.then(data=>{
						console.log(data);
					})
					.catch(err=>{
						console.log(err);
					})
					.finally(() => {
						location.reload();
					});
				};
			};
			const addButton = document.querySelector(`#add-tld-watcher`).addEventListener("click",submitHandler,false);
		})();
	</script>
</body>
</html>